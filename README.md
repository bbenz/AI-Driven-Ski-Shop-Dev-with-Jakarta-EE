# スキーリゾート管理システム - マイクロサービスアーキテクチャ

# 動作確認ビデオ

[▶️ 動作確認ビデオを見る](https://flic.kr/p/2rjkFZi)

## 📖 プロジェクト概要

このプロジェクトは、Jakarta EE 11、Java 21 LTS、そして最新のマイクロサービスアーキテクチャを使用して構築された包括的なスキーリゾート管理システムです。スキーリゾートの運営に必要なすべての機能（ユーザー管理、設備レンタル、リフト券、レッスン、支払い、カスタマーサポート）を提供します。

## 🏗️ システム全体構成図

```text
┌─────────────────────────────────────────────────────────────────┐
│                        Frontend Service                         │
│                      (Next.js - Port 3000)                     │
│                         ✅ 実装済み                              │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────────┐
│                    API Gateway Service                          │
│                 (Jakarta EE - Port 8080)                       │
│                       🚧 実装中                                  │
└─────────────┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───────────────┘
              │   │   │   │   │   │   │   │   │   │
     ┌────────┘   │   │   │   │   │   │   │   │   │
     │  ┌─────────┘   │   │   │   │   │   │   │   │
     │  │  ┌──────────┘   │   │   │   │   │   │   │
     │  │  │  ┌───────────┘   │   │   │   │   │   │
     │  │  │  │  ┌────────────┘   │   │   │   │   │
     │  │  │  │  │  ┌─────────────┘   │   │   │   │
     │  │  │  │  │  │  ┌──────────────┘   │   │   │
     │  │  │  │  │  │  │  ┌───────────────┘   │   │
     │  │  │  │  │  │  │  │  ┌────────────────┘   │
     │  │  │  │  │  │  │  │  │  ┌─────────────────┘
     ▼  ▼  ▼  ▼  ▼  ▼  ▼  ▼  ▼  ▼
   ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
   │User │ │Auth │ │Prod │ │Inv. │ │Order│
   │Mgmt │ │     │ │Cat. │ │Mgmt │ │Mgmt │
   │8081 │ │8083 │ │8082 │ │8084 │ │8085 │
   │🚧   │ │🚧   │ │✅   │ │🚧   │ │🚧   │
   └─────┘ └─────┘ └─────┘ └─────┘ └─────┘

   ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
   │Pay  │ │Cart │ │Coup │ │Loy. │ │AI   │
   │Svc  │ │Svc  │ │Svc  │ │Svc  │ │Sup. │
   │8086 │ │8087 │ │8088 │ │8089 │ │8091 │
   │🚧   │ │✅   │ │🚧   │ │🚧   │ │✅   │
   └─────┘ └─────┘ └─────┘ └─────┘ └─────┘

   ┌─────────────────────────────────────────┐
   │            データベース層                │
   │  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
   │  │PostgreSQL│  │  Redis  │  │   H2    │ │
   │  │(本番環境) │  │(キャッシュ)│  │(テスト) │ │
   │  └─────────┘  └─────────┘  └─────────┘ │
   └─────────────────────────────────────────┘
```

**凡例:**

- ✅ **実装済み**: 完全に実装され、テスト済み
- 🚧 **実装中**: 基本実装は完了、統合作業中
- ❌ **未実装**: まだ実装されていない

## 🛠️ 技術スタック

### 📋 使用プログラミング言語

- **Java 21 LTS** - バックエンドサービス（仮想スレッド、パターンマッチング等の最新機能を活用）
- **TypeScript** - フロントエンドサービス
- **SQL** - データベーススキーマ定義

### 🏢 Jakarta EE フレームワーク

- **Jakarta EE 11** - エンタープライズ機能の基盤
- **JAX-RS** - REST API の実装
- **JPA/Hibernate 6.4.1** - オブジェクトリレーショナルマッピング
- **CDI (Contexts and Dependency Injection)** - 依存性注入
- **Bean Validation** - データバリデーション
- **MicroProfile 6.1** - マイクロサービス仕様
  - MicroProfile Health - ヘルスチェック
  - MicroProfile Metrics - メトリクス収集
  - MicroProfile Config - 設定管理
  - MicroProfile OpenAPI - API文書生成

### 🖥️ フロントエンド技術

- **Next.js 15** - React フレームワーク
- **React 19** - UI ライブラリ
- **TypeScript** - 型安全性
- **Tailwind CSS** - スタイリング
- **Zustand** - 状態管理

### 🗄️ データベース・ストレージ

- **PostgreSQL 15+** - メインデータベース
- **Redis 7+** - キャッシュ・セッション管理
- **H2 Database** - テスト環境

### 🔐 セキュリティ・認証

- **JWT (JSON Web Tokens)** - 認証トークン
- **BCrypt** - パスワードハッシュ化
- **HTTPS/TLS** - 通信暗号化

### 🌐 外部サービス・ライブラリ

- **Azure OpenAI GPT-4o** - AI サポートサービス
- **LangChain4j 1.1.0** - AI チェーン処理
- **WildFly 31.0.1** - アプリケーションサーバー（Jakarta EE サービス用）
- **Docker** - コンテナ化
- **Maven 3.9+** - ビルドツール

### 📊 監視・運用

- **Prometheus** - メトリクス収集
- **Grafana** - ダッシュボード
- **構造化ログ (JSON)** - ログ管理

## 🏛️ マイクロサービス詳細

### ✅ **実装済みサービス**

#### 🖥️ 12. フロントエンドサービス (Port 3000)

- **目的**: ユーザー向けWebインターフェース
- **実装状況**: ✅ **完全実装済み**
- **主要機能**:
  - レスポンシブデザイン
  - ユーザー認証UI
  - 商品カタログ表示
  - ショッピングカート機能
  - AIサポートチャット
  - 開発者パネル（ダミーユーザー機能）
- **技術**: Next.js 15, React 19, TypeScript, Tailwind CSS
- **特徴**: PWA対応、リアルタイム更新、多言語サポート

#### 🎿 03. プロダクトカタログサービス (Port 8082)

- **目的**: 商品・サービスカタログ管理
- **実装状況**: ✅ **完全実装済み**
- **主要機能**:
  - 商品CRUD操作
  - カテゴリ管理
  - 価格設定・管理
  - 在庫状況表示
  - OpenAPI文書生成
- **技術**: Jakarta EE 11, JPA/Hibernate, PostgreSQL
- **エンティティ**: Product, Category, PriceRule, ProductVariant

#### 🛍️ 08. ショッピングカートサービス (Port 8087)

- **目的**: ショッピングカート管理
- **実装状況**: ✅ **完全実装済み**
- **主要機能**:
  - カート永続化
  - 商品追加・削除・数量変更
  - 価格計算
  - セッション管理
  - リアルタイム更新
- **技術**: Quarkus 3.15.1, Redis, WebSocket
- **特徴**: 高速レスポンス、自動クリーンアップ

#### 🤖 11. AIサポートサービス (Port 8091)

- **目的**: AI駆動カスタマーサポート
- **実装状況**: ✅ **完全実装済み**
- **主要機能**:
  - 自然言語処理
  - 自動応答生成
  - 多言語サポート
  - エスカレーション機能
  - リアルタイムチャット
- **技術**: Quarkus 3.15.1, Java 21, LangChain4j, Azure OpenAI GPT-4o
- **特徴**: Java 21プレビュー機能活用、パターンマッチング

### 🚧 **実装中サービス**（基本実装完了、統合作業中）

#### 🚪 01. APIゲートウェイサービス (Port 8080)

- **目的**: 全サービスへの統一エントリーポイント
- **機能**: リクエストルーティング、認証、レート制限、CORS処理

#### 👥 02. ユーザー管理サービス (Port 8081)

- **目的**: ユーザー登録・プロファイル管理
- **機能**: ユーザーCRUD、プロファイル管理、ロール管理

#### 🔐 04. 認証サービス (Port 8083)

- **目的**: ユーザー認証・JWT管理
- **機能**: ログイン/ログアウト、トークン更新、セッション管理

#### 📦 05. 在庫管理サービス (Port 8084)

- **目的**: 設備在庫・可用性追跡
- **機能**: 在庫管理、予約、メンテナンス追跡

#### 🛒 06. 注文管理サービス (Port 8085)

- **目的**: 注文処理・予約管理
- **機能**: 注文ライフサイクル、予約確認、キャンセル

#### 💳 07. 決済サービス (Port 8086)

- **目的**: 決済処理・取引管理
- **機能**: 複数決済方法、返金、決済追跡

#### 🎫 09. クーポン・割引サービス (Port 8088)

- **目的**: プロモーションコード・割引管理
- **機能**: クーポン検証、割引計算、使用状況追跡

#### ⭐ 10. ポイント・ロイヤルティサービス (Port 8089)

- **目的**: 顧客ロイヤルティプログラム
- **機能**: ポイント獲得、償還、ティア管理

### ⚠️ **サービス間連携の現状**

**実装済み連携**:

- フロントエンド ↔ プロダクトカタログ ✅
- フロントエンド ↔ ショッピングカート ✅
- フロントエンド ↔ AIサポート ✅
- ショッピングカート ↔ プロダクトカタログ ✅

**未実装連携**:

- その他のサービス間連携は現在作業中
- APIゲートウェイ経由の統合アクセスは実装中
- 認証サービスとの統合は実装中

## 🚀 サービス起動手順

### 📋 前提条件

- Java 21 LTS
- Node.js 18+
- Maven 3.9+
- Docker & Docker Compose
- PostgreSQL 15+ (Dockerで提供)
- Redis 7+ (Dockerで提供)

### 🔄 起動順序（推奨）

#### 1️⃣ **インフラストラクチャ起動**

```bash
# PostgreSQL と Redis を起動
cd /Users/teradayoshio/GitHub/JakartaOne2025/microservices
docker-compose up -d postgres redis
```

#### 2️⃣ **プロダクトカタログサービス起動**

```bash
cd 03-product-catalog-service

# データベース初期化
docker-compose up -d postgres

# サービス起動
./run.sh
# または
mvn clean compile quarkus:dev

# 確認: http://localhost:8082/health
```

#### 3️⃣ **ショッピングカートサービス起動**

```bash
cd 08-shopping-cart-service

# サービス起動
./run.sh
# または
mvn clean compile quarkus:dev

# 確認: http://localhost:8087/health
```

#### 4️⃣ **AIサポートサービス起動**

```bash
cd 11-ai-support-service

# Docker環境で起動
docker-compose up -d

# 確認: http://localhost:8091/health
```

#### 5️⃣ **フロントエンドサービス起動**

```bash
cd 12-frontend-service

# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev

# アクセス: http://localhost:3000
```

### 🔧 **開発用ダミーユーザー**

フロントエンドには開発用のダミーユーザー機能が実装されています：

- **メールアドレス**: `demo@skiresort.com`
- **パスワード**: `demo123`
- **名前**: 田中 太郎
- **権限**: カスタマー権限（商品閲覧、購入等）

**利用方法**:

1. <http://localhost:3000> にアクセス
2. 画面右上の「開発者パネル」でダミーユーザーを有効化
3. ログインページで「デモアカウント情報を入力」をクリック
4. 全機能をテスト可能

### 📊 **ヘルスチェック・モニタリング**

各サービスのヘルスチェックエンドポイント：

- プロダクトカタログ: <http://localhost:8082/health>
- ショッピングカート: <http://localhost:8087/health>
- AIサポート: <http://localhost:8091/health>
- フロントエンド: <http://localhost:3000> (Next.js built-in health)

### 🔍 **API文書**

実装済みサービスのAPI文書：

- プロダクトカタログ: <http://localhost:8082/q/openapi>
- ショッピングカート: <http://localhost:8087/q/swagger-ui>
- AIサポート: <http://localhost:8091/q/swagger-ui>

## 🎯 今後の開発予定

### 📅 短期目標 (1-2週間)

1. **APIゲートウェイサービス完成** - 統一エントリーポイント確立
2. **認証サービス統合** - JWT ベース認証の完全実装
3. **ユーザー管理サービス統合** - ユーザープロファイル管理

### 📅 中期目標 (1ヶ月)

1. **注文・決済フロー完成** - エンドツーエンド購買体験
2. **在庫管理システム統合** - リアルタイム在庫追跡
3. **ロイヤルティプログラム** - ポイント獲得・使用システム

### 📅 長期目標 (2-3ヶ月)

1. **本番環境デプロイ** - Kubernetes クラスター展開
2. **パフォーマンス最適化** - Java 21 仮想スレッド活用
3. **高可用性対応** - 障害復旧・スケーリング対応

## 🤝 開発者向け情報

### 📝 コーディング規約

- Java 21 のモダン機能を積極活用
- 依存性注入はコンストラクターインジェクション推奨
- 包括的エラーハンドリング
- ユニット・統合テスト必須

### 🧪 テスト戦略

- **単体テスト**: JUnit 5 + Mockito
- **統合テスト**: TestContainers
- **契約テスト**: OpenAPI 仕様準拠
- **E2Eテスト**: REST Assured

### 📈 パフォーマンス設計

- **Java 21 仮想スレッド** - 高並行性処理
- **コネクションプール** - データベース効率化
- **Redis キャッシュ** - 高速データアクセス
- **非同期処理** - 長時間実行タスク

## 📄 ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。

## 📞 サポート・お問い合わせ

- **プロジェクト Wiki**: [GitHub Wiki](https://github.com/jakartaone2025/ski-resort-system/wiki)
- **Issues**: [GitHub Issues](https://github.com/jakartaone2025/ski-resort-system/issues)
- **ディスカッション**: [GitHub Discussions](https://github.com/jakartaone2025/ski-resort-system/discussions)

---

**最終更新**: 2025年7月28日  
**プロジェクト状況**: アクティブ開発中 🚧
